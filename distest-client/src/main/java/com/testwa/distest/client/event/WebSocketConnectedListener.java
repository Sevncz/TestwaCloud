package com.testwa.distest.client.event;import com.github.cosysoft.device.android.AndroidDevice;import com.github.cosysoft.device.android.impl.AndroidDeviceStore;import com.testwa.distest.client.service.GrpcClientService;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.ApplicationListener;import org.springframework.scheduling.annotation.Async;import org.springframework.stereotype.Component;import java.util.TreeSet;@Slf4j@Componentpublic class WebSocketConnectedListener implements ApplicationListener<WebSocketConnectedEvent> {    @Autowired    private GrpcClientService grpcClientService;    private static boolean isInit = false;    @Async    @Override    public void onApplicationEvent(WebSocketConnectedEvent webSocketConnectedEvent) {        if(!isInit){            TreeSet<AndroidDevice> androidDevices = AndroidDeviceStore.getInstance().getDevices();            log.info("Event: 客户端已连接，初始化{}台设备", androidDevices.size());            for (AndroidDevice ad : androidDevices) {                if(ad.isDeviceReady()){                    grpcClientService.initDevice(ad);                    grpcClientService.createRemoteClient(ad.getDevice());                }            }            isInit = true;        }    }}