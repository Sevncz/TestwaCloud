package com.testwa.distest.client.event;import com.github.cosysoft.device.android.AndroidDevice;import com.testwa.distest.client.android.AndroidHelper;import com.testwa.distest.client.control.client.Clients;import com.testwa.distest.client.control.client.DeviceClientCache;import com.testwa.distest.client.service.GrpcClientService;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.ApplicationListener;import org.springframework.scheduling.annotation.Async;import org.springframework.stereotype.Component;@Slf4j@Componentpublic class DeviceDisconnectListener implements ApplicationListener<DeviceDisconnectEvent> {    @Autowired    private GrpcClientService grpcClientService;    @Async    @Override    public void onApplicationEvent(DeviceDisconnectEvent event) {        AndroidDevice ad = null;        try {            ad = AndroidHelper.getInstance().getAndroidDevice(event.getDeviceId());        }catch (Exception e){        }        if(ad == null){            log.info("Event: 设备 " + event.getDeviceId() + " 断开，即将停止所有任务");            grpcClientService.deviceDisconnect(event.getDeviceId());//        Clients.remove(event.getDeviceId());            DeviceClientCache.remove(event.getDeviceId());        }    }}